<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸ‘¥Customer Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Main Dashboard Theme -->
    <link rel="stylesheet" href="{{ url_for('static',filename='dashborad.css') }}">

    <!-- Customer Page Styles -->
    <link rel="stylesheet" href="{{ url_for('static',filename='customer.css') }}">
</head>
<body>

    <!-- ================= MAIN CONTENT ================= -->
    <main class="main">

        <!-- ================= HEADER ================= -->
        <div class="topbar">
            <div>
                <h1>Customers</h1>
                <p>View and manage customer instrument records</p>
            </div>
        </div>

        <!-- ================= CUSTOMER LIST ================= -->
        <div class="panel">
            <h2>Customer List</h2>

            <table>
                <thead>
                    <tr>
                        <th>c_ID</th>
                        <th>Company Name</th>
                        <th>Company Type</th>
                        <th>Contact Name</th>
                        <th>Contact_mail</th>
                        <th>Contact_phone</th>
                        <th class="action-col">Actions</th>
                    </tr>
                </thead>
                <tbody id="customerTableBody">
                    <tr class="empty-row">
                        <td colspan="7">No records found</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ================= ADD CUSTOMER ================= -->
        <div class="panel">
            <h2>Add New Customer</h2>

            <form class="customer-form">
                <div class="form-group">
                    <label >C_ID *</label>
                    <input id="cid" type="text" required>
                </div>
              
                <div class="form-group">
                    <label >Company Name *</label>
                    <input id="cname" type="text" required>
                </div>

                <div class="form-group">
                    <label >Company Type *</label>
                    <input id="ctype" type="text" required>
                </div>
              
                <div class="form-group">
                    <label >Contact Name *</label>
                    <input id="ccname" type="text" required>
                </div>

                <div class="form-group">
                    <label >Email *</label>
                    <input id="cmail" type="email" required>
                </div>

                <div class="form-group">
                    <label >Phone *</label>
                    <input id="phone" type="tel" required>
                </div>

                <button type="button" class="btn-save" onclick='load()'>
                    Save Customer
                </button>
            </form>
        </div>

        <div id="editCardOverlay" class="overlay hidden">
    <div class="edit-card">
        <h3>Edit Customer</h3>

        <input type="hidden" id="edit_company_id">

        <label>Company Name</label>
        <input type="text" id="edit_company_name">

        <label>Company Type</label>
        <input type="text" id="edit_company_type">

        <label>Contact Name</label>
        <input type="text" id="edit_contact_name">

        <label>Contact Email</label>
        <input type="email" id="edit_contact_mail">

        <label>Contact Phone</label>
        <input type="text" id="edit_contact_phone">

        <div class="card-actions">
            <button class="btn-edit" onclick="updateCustomer()">Update</button>
            <button class="btn-delete" onclick="closeEditCard()">Cancel</button>
        </div>
    </div>
</div>

    </main>

</body>
<!--<script src="{{ url_for('static',filename='customer.js') }}"></script>-->
<script>
/* Load Customers in th Table  */
loadCustomers();

let customers = [];

/* Add customer details in data */
function load(){
const details = {
        cid: document.getElementById("cid").value,
        cname: document.getElementById("cname").value,
        ctype: document.getElementById("ctype").value,
        ccname: document.getElementById("ccname").value,
        cmail: document.getElementById("cmail").value,
        cphone: document.getElementById("phone").value
    };

fetch("/api/add_customers", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(details)
    })
    .then(res => res.json())
    .then(response => {
        alert(response.message);
        document.getElementById("customerForm").reset();
        loadCustomers();
    
    })
    .catch(err => console.error("Error:", err));
}
    
/* Load Customer Table */
function loadCustomers() {

fetch("/api/customers")
  .then(r => r.json())
  .then(data => {
    const tbody = document.getElementById("customerTableBody");
    tbody.innerHTML = "";
    customers=data;

if (data.length === 0) {
    // show NOTHING when empty (as requested)
} else {
    data.forEach(c => {
        tbody.innerHTML += `
            <tr>
                <td>${c.company_id}</td>
                <td>${c.company_name}</td>
                <td>${c.company_type}</td>
                <td>${c.conatct_name}</td>
                <td>${c.cantact_mail}</td>
                <td>${c.contact_phone}</td>
                <td class="action-col">
                    <button class="btn-edit" onclick="editCustomer(${c.company_id})">Edit</button>
                    <button class="btn-delete" onclick="deleteCustomer(${c.company_id})">Delete</button>
                </td>
            </tr>
        `;
    });
}
})
}
/* Delete Customers */
function deleteCustomer(id) {
    if (!confirm("Are you sure you want to delete this customer?")) {
        return;
    }
    fetch("/api/del_cus" ,{
        method : "POST",
        headers : { "Content-Type":"application/json"},
        body : JSON.stringify({company_id: id})
        })
        .then(res => res.json())
        .then(response => {
            alert(response.message);
            loadCustomers();
        });
}
/* Edit Customers */
function editCustomer(id) {
    // find customer from loaded data (example: customers array)
    const customer = customers.find(c => String(c.company_id) === String(id));
    if (!customer) return;

    document.getElementById("edit_company_id").value = customer.company_id;
    document.getElementById("edit_company_name").value = customer.company_name;
    document.getElementById("edit_company_type").value = customer.company_type;
    document.getElementById("edit_contact_name").value = customer.conatct_name;
    document.getElementById("edit_contact_mail").value = customer.cantact_mail;
    document.getElementById("edit_contact_phone").value = customer.contact_phone;

    document.getElementById("editCardOverlay").classList.remove("hidden");
}

function closeEditCard() {
    document.getElementById("editCardOverlay").classList.add("hidden");
}

function updateCustomer() {
    const data = {
        company_id: document.getElementById("edit_company_id").value,
        company_name: document.getElementById("edit_company_name").value,
        company_type: document.getElementById("edit_company_type").value,
        contact_name: document.getElementById("edit_contact_name").value,
        contact_mail: document.getElementById("edit_contact_mail").value,
        contact_phone: document.getElementById("edit_contact_phone").value
    };

    fetch("/api/update_customers", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then( response => {
        alert(response.message);
        closeEditCard();
        loadCustomers(); // reload table
    });
}

    
</script>
</html>
