<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Command Dashboard | Service Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Premium Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

  <!-- Dashboard CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='dashborad.css') }}">
</head>

<body>

<!-- ================= SIDEBAR ================= -->
<aside class="sidebar">
  <div class="brand">
    ⚙️ <span>POLAR ANALYTICS</span>
    <small>Service Intelligence</small>
  </div>

  <nav>
    <a class="active" href="{{ url_for('dashboard') }}">Dashboard</a>
    <a href="{{ url_for('customer.html') }}">Customers</a>
    <a href="#">Instruments</a>
    <a href="#">Service Records</a>
    <a href="#">Data Export</a>
    <a href="#">User Control</a>
  </nav>

  <div class="sidebar-footer">
    <div id="user-email">—</div>
    <button class="logout-btn" onclick="logout()">Logout</button>
    <small>AI Engine • v1.0</small>
  </div>
</aside>

<!-- ================= MAIN ================= -->
<main class="main">

  <!-- HEADER -->
  <header class="topbar">
    <div>
      <h1>Command Dashboard</h1>
      <p>Operational Intelligence Overview</p>
    </div>
    <div class="date" id="current-date"></div>
  </header>

  <!-- ================= STATS ================= -->
  <section class="stats">
    <div class="stat bronze">
      <h3>Total Clients</h3>
      <span id="total-customers">—</span>
    </div>

    <div class="stat steel">
      <h3>Instruments</h3>
      <span id="active-instruments">—</span>
    </div>

    <div class="stat amber">
      <h3>Pending Services</h3>
      <span id="pending-services">—</span>
    </div>

    <div class="stat crimson">
      <h3>Critical Alerts</h3>
      <span id="critical-issues">—</span>
    </div>
  </section>

  <!-- ================= GRID ================= -->
  <section class="grid">

    <!-- RECENT CUSTOMERS -->
    <div class="panel">
      <h2>Recent Clients</h2>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Company ID</th>
              <th>Company Name</th>
              <th>Contact Person</th>
              <th>Phone</th>
            </tr>
          </thead>
          <tbody id="recent-customers-body">
            <tr>
              <td colspan="4">Loading intelligence…</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- PENDING SERVICES -->
    <div class="panel">
      <h2>Pending Service Actions</h2>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>S.NO</th>
              <th>Company</th>
              <th>Instrument_name</th>
              <th>Serial_no</th>
              <th>Problem </th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="pending-services-body">
            <tr>
              <td colspan="4">Analyzing service logs…</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </section>

</main>

<!-- ================= AUTH ================= -->
<script src="{{ url_for('static', filename='auth.js') }}"></script>

<script>


/* ---------- DATE ---------- */
const date = new Date();
document.getElementById("current-date").innerText =
  date.toLocaleDateString("en-IN", {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

/* ---------- DASHBOARD STATS ---------- */
fetch("/api/dashboard/stats")
  .then(res => res.json())
  .then(d => {
    document.getElementById("total-customers").innerText = d.customers ?? "0";
    document.getElementById("active-instruments").innerText = d.instruments ?? "0";
    document.getElementById("pending-services").innerText = d.pending_services ?? "0";
    document.getElementById("critical-issues").innerText = d.critical ?? "0";
  });

/* ---------- RECENT CUSTOMERS ---------- */
fetch("/api/customers/recent")
  .then(r => r.json())
  .then(data => {
    const body = document.getElementById("recent-customers-body");
    body.innerHTML = "";

    if (!data.length) {
      body.innerHTML = `<tr><td colspan="4">No recent records</td></tr>`;
      return;
    }

    data.forEach(c => {
      body.innerHTML += `
        <tr>
          <td>${c.company_id}</td>
          <td>${c.company_name}</td>
          <td>${c.conatct_name}</td>
          <td>${c.contact_phone}</td>
        </tr>`;
    });
  });

/* ---------- PENDING SERVICES ---------- */
fetch("/api/services/pending")
  .then(r => r.json())
  .then(data => {
    const body = document.getElementById("pending-services-body");
    body.innerHTML = "";

    if (!data.length) {
      body.innerHTML = `<tr><td colspan="4">No pending services</td></tr>`;
      return;
    }

    data.forEach((s,i) => {
      body.innerHTML += `
        <tr>
          <td>${i+1}</td>
          <td>${s.company_name}</td>
          <td>${s.i_type}</td>
          <td>${s.i_serial}</td>
          <td>${s.problem_reported}</td>
          <td>${s.status}</td>
        </tr>`;
    });
  });
</script>

</body>
</html>
